---
---

<p class="mb-3">
  <em>CAe</em> = <em>Clavis Aethiopica</em>.<br>
  Chaîne = Marius Chaîne, “<a href="{{ '/works/chaine/' | relative_url }}">Répertoire des salam et malke'e</a>,” <i>ROC</i> 18 (1913): 183–203, 337–57.
</p>

<table class="table is-fullwidth">

  <thead>

    <tr>
      <td>
        <input class="input" type="number" placeholder="CAe" min="{{ site.works.first.title }}" max="{{ site.works.last.title }}" style="max-width: 5em; min-width: 3.5em;" />
      </td>

      <td colspan="2">
        <input class="input" type="text" placeholder="Title or incipit" />
      </td>
    </tr>

  </thead>
    
  {% for work in site.works %}
  <tbody id="{{ work.title }}">

    <tr>

      <td class="is-linked" rowspan="2">
        <span><em>CAe</em>: {{ work.title }}</span>
        {% if work.chaine %}
        <br><small>Chaîne: {{ work.chaine | join: ", " }}</small>
        {% endif %}
      </td>

      <td class="is-linked">
        <a href="{{ work.url }}">
          <strong lang="gez">{{ work.titles[0].gez | fidal }}</strong>
          <br><small lang="gez-latn">{{ work.titles[0].gez }}</small>
        </a>
      </td>

      <td class="is-linked">
        <a href="{{ work.url }}">
          <strong>{{ work.titles[0].en }}</strong>
        </a>
      </td>

      <td rowspan="2" style="text-align: center;">
        <a class="button expands is-link is-size-4 px-4 py-1 mt-5" data-target="">+</a>
      </td>

    </tr>

    <tr>
      
      <td class="is-linked is-hidden-desktop" colspan="2">
        <span class="collapsible">{{ work.stanzas[1][0] }}</span>
        <ol class="stanzas collapsible is-hidden">
          <li>
            <ul>
              <li>{{ work.stanzas[1][0] }}</li>
              <li>{{ work.stanzas[1][1] }}</li>
              <li class="ellipsis"></li>
            </ul>
          </li>
          {% if work.stanzas[2] %}
          <li>
            <ul>
              <li>{{ work.stanzas[2][0] }}</li>
              <li>{{ work.stanzas[2][1] }}</li>
              <li class="ellipsis"></li>
            </ul>
          </li>
          {% endif %}
        </ol>
      </td>

      <td class="is-linked is-hidden-touch" colspan="1">
        <span class="collapsible">{{ work.stanzas[1][0] }}</span>
        <ol class="stanzas collapsible is-hidden">
          <li>
            <ul>
              <li>{{ work.stanzas[1][0] }}</li>
              <li>{{ work.stanzas[1][1] }}</li>
              <li class="ellipsis"></li>
            </ul>
          </li>
          {% if work.stanzas[2] %}
          <li>
            <ul>
              <li>{{ work.stanzas[2][0] }}</li>
              <li>{{ work.stanzas[2][1] }}</li>
              <li class="ellipsis"></li>
            </ul>
          </li>
          {% endif %}
        </ol>
      </td>

      <td class="is-linked is-hidden-touch" colspan="1">
        {% if work.subjects.size > 0 %}
        <span class="collapsible">
          {% for subject in work.subjects %}
          <a href="{{ subject.url }}">{{ subject.name.en }}</a>{% unless forloop.last %}, {% endunless %}
          {% endfor %}
        </span>
        <span class="collapsible is-hidden">
          <ul style="list-style-position: outside; margin-inline-start: 2em;">
            {% for subject in work.subjects %}
            <li style="list-style: disc; margin-bottom: 0.75rem;">
              <span class="tag is-dark is-pulled-right">{{ subject.category }}</span>
              <a href="{{ subject.url }}">
                <strong lang="gez">{{ subject.name.gez | fidal }}</strong>
                {% if subject.name.gez.size > 10 %}<br>{% endif %}
                <small lang="gez-latn">{{ subject.name.gez }}</small>
                <br><span lang="en">{{ subject.name.en }}</span>
              </a>
            </li>
            {% endfor %}
          </ul>
        </span>
        {% endif %}
      </td>

    </tr>

  </tbody>
  {% endfor %}

</table>

<p class="has-text-right is-size-7 mt-3">
  <strong>{{ site.works.size }}</strong> total work records.
</p>

<script src="{{ '/assets/scripts/fuse/dist/fuse.min.js' | relative_url }}"></script>
<script>

$(document).ready(function() {

  $('.button.expands').on('click', function() {

    $(this).parents('tbody').find('.collapsible').toggleClass('is-hidden');

  });


  $.getJSON('api/search-index-small.json', function( data ) {

    const fuse = new Fuse(data, {
      includeScore: true,
      keys: [
        { 'name': 'titles', 'weight': 0.7 },
        { 'name': 'incipit', 'weight': 0.3 }
      ]
    });

    $('input.input').on('keyup keypress change', function() {

      $('table.table').addClass('results').children().removeAttr('data-rank');

      var search = $(this).val();

      if ( $(this).attr('type') == 'number' ) $(`tbody[id^='${search}']`).attr('data-rank', 1);

      else {

        var results = fuse.search(search);

        results.forEach(function ( result ) {
          $(`#${result.item.clavis}`).attr('data-rank', result.score);
        });
      
      }

      if ( search == "" ) $('table.table tbody').attr('data-rank', 0);

      $('table.table tbody[data-rank]').sort(function (a, b) {
        score = parseFloat(a.dataset.rank) - parseFloat(b.dataset.rank);
        if (score == 0) return parseInt(a.id) - parseInt(b.id);
        else return score;
      }).appendTo('table.table');

    });

  });

});
</script>